<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Book a cab</title>
  <link rel="shortcut icon" href="/static/pic/logo/AC favi logo.png" type="image/x-icon">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
  <link rel="stylesheet" href="/static/cab.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">


</head>

<body>
  <!-- The loading overlay -->
  <div id="loading" >
    <div class="loading-content">
      <img src="/static/pic/logo/AC favi logo.png" alt="">
      <p>APNA CINEMA</p>
      <span class="loader"></span>
    </div>

  </div>

  <!-- The overlay -->
  <div id="myNav" class="overlay">

  <!-- Overlay content -->
  <div class="overlay-content">
      <div class="overlay-img">

        <img src="/static/pic/logo/AC favi logo.png" alt="">
      </div>
      <div class="overlay-para">

        <p>Want to book a cab</p>
        <div id="options">
          <button type="button" onclick="closeNav()" class="btn btn-success">Yes</button>

          <a href="/<%=moviedata.url%>/restaurant">
            <button type="button" class="btn btn-danger">No</button>
          </a>
        </div>
      </div>
    </div>

  </div>



  <header>
    <%- include("../partials/navbar.ejs") %>
  </header>

  <main id="main">
    <div id="map"></div>
    <a href="/<%=moviedata.url%>/restaurant"><button type="button" class="btn skip">Skip</button></a>

    <div class="cabDetails">
      <label>From :</label>
      <input type="text" id="from">
      <button type="button" onclick="frombtn()" class="btn btn-success">Search</button>
      <label>To :</label>
      <input type="text" id="to" disabled>
      <label>Pickup Time :</label>
      <h2 id="pickup-time">00:00 AM</h2>
      <label id="dist">Total Distance :</label>
      <h2 id="distance">0</h2>
    </div>

    <div class="taxi">

      <div class="bike card mb-3 cab" id="bike">
        <div class="cardimg">
          <img src="/static/pic/taxi/scooter.png" class="img-fluid rounded-start" alt="...">
        </div>
        <div class="cardbody">
          <h3 class="card-title" value="bike">Bike</h3>
          <p>Beat the traffic on a bike
          </p>
          <h4>&#8377;</h4>
          <h4 class="cab-price">0</h4>
          <a href="/<%=moviedata.url%>/restaurant" class=""><button type="button" id="bike-btn" onclick="pay(this)"
              class="btn btn-success">Book Now</button></a>
        </div>
      </div>

      <div class="auto card mb-3 cab" id="auto">
        <div class="cardimg">
          <img src="/static/pic/taxi/auto.png" class="img-fluid rounded-start" alt="...">
        </div>
        <div class="cardbody">
          <h3 class="card-title" value="auto">Auto</h3>
          <p>Affordable autos</p>
          <h4>&#8377;</h4>

          <h4 class="cab-price">0</h4>

          <a href="/<%=moviedata.url%>/restaurant" class=""><button type="button" onclick="pay(this)"
              class="btn btn-success">Book Now</button></a>
        </div>
      </div>

      <div class="car card mb-3 cab" id="car">
        <div class="cardimg">
          <img src="/static/pic/taxi/car.png" class="img-fluid rounded-start" alt="...">
        </div>
        <div class="cardbody">
          <h3 class="card-title" value="car">Car</h3>
          <p>Spacious and comfy cars</p>
          <h4>&#8377;</h4>

          <h4 class="cab-price">0</h4>

          <a href="/<%=moviedata.url%>/restaurant" class=""><button type="button" onclick="pay(this)"
              class="btn btn-success">Book Now</button></a>
        </div>
      </div>

      <div class="bus card mb-3 cab" id="bus">
        <div class="cardimg">
          <img src="/static/pic/taxi/bus.png" class="img-fluid rounded-start" alt="...">
        </div>
        <div class="cardbody">
          <h3 class="card-title" value="bus">Bus</h3>
          <p>Whole Family Ride</p>
          <h4>&#8377;</h4>

          <h4 class="cab-price">0</h4>

          <a href="/<%=moviedata.url%>/restaurant" class=""><button type="button" onclick="pay(this)"
              class="btn btn-success">Book Now</button></a>
        </div>
      </div>

    </div>
  </main>

  <%- include("../partials/footer.ejs") %>


    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.0/umd/popper.min.js"
      integrity="sha384-cs/chFZiN24E4KMATLdqdvsezGxaGsi4hLGOzlXwp5UZB1LY//20VyM2taTB4QvJ"
      crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
      integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />


    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
      integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.2.0/dist/leaflet.css" />
    <link rel="stylesheet" href="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.css" />
    <script src="https://unpkg.com/leaflet@1.2.0/dist/leaflet.js"></script>
    <script src="https://unpkg.com/leaflet-routing-machine@latest/dist/leaflet-routing-machine.js"></script>

    <script src="/static/cab.js"></script>





</body>
<script type="text/javascript">
  var placeString = sessionStorage.getItem('place')
  var timeString = sessionStorage.getItem('time')

  var place = JSON.parse(placeString);
  var time = JSON.parse(timeString);

  document.getElementById('to').value = place;
  document.getElementById('pickup-time').innerHTML = `${time}`;



  function frombtn() {
    reinitializeMap();

  };
  function reinitializeMap() {
    if (map) {
      map.remove();
      var newDiv = document.createElement("div");
      newDiv.id="map";
      var main=document.getElementById("main");
      main.prepend(newDiv);
    }
    initMap(); 
  }



  window.onload = initMap();






  //google maps api

  // function initMap() {

  //   let from_address;
  //   let coords;

  //   //fetch the current location of user
  //   navigator.geolocation.getCurrentPosition((position) => {

  //     myLat = position.coords.latitude;
  //     myLong = position.coords.longitude;
  //     coords = new google.maps.LatLng(myLat, myLong);
  //     var google_maps_geocoder = new google.maps.Geocoder();
  //     fetchAddressbyCoords(coords);
  //     from_address = localStorage.getItem("address");


  //     function fetchAddressbyCoords(coords) {
  //       google_maps_geocoder.geocode(
  //         { 'latLng': coords },
  //         function (results, status) {
  //           var address = results[0].formatted_address;
  //         }
  //       )
  //     };
  //     //If mannually adding the pick address
  //     var from_address = document.getElementById("from").value;
  //     google_maps_geocoder.geocode({ 'address': from_address }, async function (results, status) {
  //       if (status == 'OK') {
  //         coords = results[0].geometry.location;
  //         fetchAddressbyCoords(coords);
  //         from_address = localStorage.getItem("address");
  //         from_pos = document.getElementById("from");
  //         from_pos.value = from_address;

  //         //fetch coordinates of drop address

  //         var to_address = document.getElementById('to').value;
  //         var end_coords;
  //         google_maps_geocoder.geocode({ 'address': to_address }, async function (results, status) {
  //           var end_coords = results[0].geometry.location;
  //           google_maps_geocoder.geocode(
  //             { 'latLng': end_coords },
  //             function (results, status) {
  //               to_address = results[0].formatted_address;
  //             }
  //           )

  //           to_pos = document.getElementById("to");
  //           to_pos.value = to_address;

  //           var mapOptions = {
  //             zoom: 15,
  //             center: coords,
  //             mapTypeId: google.maps.MapTypeId.ROADMAP,

  //           }
  //           var map = new google.maps.Map(document.getElementById('map'), mapOptions);

  //           //direction between two places
  //           var directionsService = new google.maps.DirectionsService();
  //           var directionsRenderer = new google.maps.DirectionsRenderer({
  //             draggable: true,
  //             map,
  //           });

  //           directionsRenderer.addListener("directions_changed", () => {
  //             const directions = directionsRenderer.getDirections();
  //             origin_location = directions.request.origin;
  //             coords = origin_location;
  //             fetchAddressbyCoords(origin_location);
  //             fetchDistance(coords, end_coords);

  //             from_address = localStorage.getItem("address");
  //             from_pos = document.getElementById("from");
  //             from_pos.value = from_address;

  //           });


  //           displayRoute(
  //             coords,
  //             end_coords,
  //             directionsService,
  //             directionsRenderer,
  //           );


  //           function displayRoute(origin, destination, service, display) {
  //             service
  //               .route({
  //                 origin: origin,
  //                 destination: destination,
  //                 travelMode: google.maps.TravelMode.DRIVING,
  //                 avoidTolls: true,
  //               })
  //               .then((result) => {
  //                 display.setDirections(result);


  //               })
  //               .catch((e) => {
  //                 alert("Could not display directions due to: " + e);
  //               });

  //           }

  //           //Distance between two places
  //           fetchDistance(coords, end_coords);
  //           function fetchDistance(coords, end_coords) {

  //             var service = new google.maps.DistanceMatrixService();
  //             service.getDistanceMatrix({
  //               origins: [coords],
  //               destinations: [end_coords],
  //               travelMode: google.maps.TravelMode.DRIVING,
  //               unitSystem: google.maps.UnitSystem.METRIC,
  //               avoidHighways: false,
  //               avoidTolls: false,
  //             }).then((response) => {
  //               distance = parseFloat(response.rows[0].elements[0].distance.value);
  //               distance = distance / 1000;
  //               distance = distance.toFixed(2);

  //               document.getElementById('distance').innerHTML = `${distance} KM`;
  //               //price for bike
  //               document.getElementById('bike').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 2).toFixed(2)}`;

  //               //price for auto
  //               document.getElementById('auto').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 5).toFixed(2)}`;

  //               //price for car
  //               document.getElementById('car').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 7).toFixed(2)}`;

  //               //price for car
  //               document.getElementById('bus').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 10).toFixed(2)}`;
  //             })
  //           }
  //         });

  //       }
  //       else {
  //         from_address = localStorage.getItem("address");
  //         from_pos = document.getElementById("from");
  //         from_pos.value = from_address;

  //         //fetch coordinates of drop address
  //         var to_address = document.getElementById('to').value;
  //         var end_coords;
  //         google_maps_geocoder.geocode({ 'address': to_address }, async function (results, status) {
  //           var end_coords = results[0].geometry.location;
  //           google_maps_geocoder.geocode(
  //             { 'latLng': end_coords },
  //             function (results, status) {
  //               to_address = results[0].formatted_address;
  //             }
  //           )

  //           to_pos = document.getElementById("to");
  //           to_pos.value = to_address;

  //           var mapOptions = {
  //             zoom: 15,
  //             center: coords,
  //             mapTypeId: google.maps.MapTypeId.ROADMAP,

  //           }
  //           var map = new google.maps.Map(document.getElementById('map'), mapOptions);

  //           //direction between two places
  //           var directionsService = new google.maps.DirectionsService();
  //           var directionsRenderer = new google.maps.DirectionsRenderer({
  //             draggable: true,
  //             map,
  //           });

  //           directionsRenderer.addListener("directions_changed", () => {
  //             const directions = directionsRenderer.getDirections();
  //             origin_location = directions.request.origin;
  //             coords = origin_location;
  //             fetchAddressbyCoords(origin_location);
  //             fetchDistance(coords, end_coords);
  //             from_address = localStorage.getItem("address");
  //             from_pos = document.getElementById("from");
  //             from_pos.value = from_address;

  //           });


  //           displayRoute(
  //             coords,
  //             end_coords,
  //             directionsService,
  //             directionsRenderer,
  //           );


  //           function displayRoute(origin, destination, service, display) {
  //             service
  //               .route({
  //                 origin: origin,
  //                 destination: destination,
  //                 travelMode: google.maps.TravelMode.DRIVING,
  //                 avoidTolls: true,
  //               })
  //               .then((result) => {
  //                 display.setDirections(result);


  //               })
  //               .catch((e) => {
  //                 alert("Could not display directions due to: " + e);
  //               });

  //           }





  //           //Distance between two places
  //           fetchDistance(coords, end_coords);
  //           function fetchDistance(coords, end_coords) {

  //             var service = new google.maps.DistanceMatrixService();
  //             service.getDistanceMatrix({
  //               origins: [coords],
  //               destinations: [end_coords],
  //               travelMode: google.maps.TravelMode.DRIVING,
  //               unitSystem: google.maps.UnitSystem.METRIC,
  //               avoidHighways: false,
  //               avoidTolls: false,
  //             }).then((response) => {
  //               distance = parseFloat(response.rows[0].elements[0].distance.value);
  //               distance = distance / 1000;
  //               distance = distance.toFixed(2);

  //               document.getElementById('distance').innerHTML = `${distance} KM`;
  //               //price for bike
  //               document.getElementById('bike').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 5).toFixed(2)}`;

  //               //price for auto
  //               document.getElementById('auto').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 7).toFixed(2)}`;

  //               //price for car
  //               document.getElementById('car').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 10).toFixed(2)}`;

  //               //price for car
  //               document.getElementById('bus').lastElementChild.lastElementChild.previousElementSibling.innerHTML = `${(distance * 20).toFixed(2)}`;

  //             })
  //           }
  //         });

        // }
      // });



    // });
  // }



</script>


</html>